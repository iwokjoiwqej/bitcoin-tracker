<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Bitcoin Tracker with Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 40px;
    }
    #price {
      font-size: 2rem;
      margin-bottom: 20px;
      transition: color 0.3s;
    }
    #btcChart {
      max-width: 600px;
      margin: 0 auto;
    }
  </style>
</head>
<body>
  <h1>🚀 내 비트코인 트래커</h1>
  <p>현재 비트코인 가격 (USD):</p>
  <div id="price">불러오는 중...</div>
  <canvas id="btcChart" width="600" height="300"></canvas>

  <script>
    let previousPrice = null;
    let chart = null;
    let labels = [];
    let dataPoints = [];

    const priceElement = document.getElementById('price');
    const ctx = document.getElementById('btcChart').getContext('2d');

    function initChart() {
      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'BTC 가격 (USD)',
            data: dataPoints,
            borderColor: 'blue',
            borderWidth: 2,
            fill: false
          }]
        },
        options: {
          responsive: true,
          animation: false,
          scales: {
            x: {
              title: { display: true, text: '시간' }
            },
            y: {
              title: { display: true, text: '가격 ($)' },
              beginAtZero: false
            }
          }
        }
      });
    }

    async function fetchBTC() {
      try {
        const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd');
        const data = await res.json();
        const currentPrice = data.bitcoin.usd;
        const now = new Date().toLocaleTimeString();

        priceElement.textContent = `$${currentPrice.toLocaleString()}`;

        if (previousPrice !== null) {
          if (currentPrice > previousPrice) {
            priceElement.style.color = 'green';
          } else if (currentPrice < previousPrice) {
            priceElement.style.color = 'red';
          } else {
            priceElement.style.color = 'black';
          }
        }

        previousPrice = currentPrice;

        labels.push(now);
        dataPoints.push(currentPrice);
        if (labels.length > 20) {
          labels.shift();
          dataPoints.shift();
        }
        chart.update();
      } catch (err) {
        priceElement.textContent = '가격 불러오기 오류';
        console.error(err);
      }
    }

    initChart();
    fetchBTC();
    setInterval(fetchBTC, 10000);
  </script>
</body>
</html>
